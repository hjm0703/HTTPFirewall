<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WFP Firewall Manager</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* éšè—æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar { display: none; }
        html { scrollbar-width: none; -ms-overflow-style: none; }
        body { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* ä¸»é¢˜å˜é‡ */
        :root {
            --bg-gradient: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            --text-primary: #fff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-muted: rgba(255, 255, 255, 0.5);
            --text-faint: rgba(255, 255, 255, 0.3);
            --surface: rgba(255, 255, 255, 0.03);
            --surface-hover: rgba(255, 255, 255, 0.08);
            --surface-active: rgba(255, 255, 255, 0.1);
            --border: rgba(255, 255, 255, 0.1);
            --border-light: rgba(255, 255, 255, 0.05);
            --border-hover: rgba(255, 255, 255, 0.15);
            --accent-start: #00d4ff;
            --accent-end: #7c3aed;
            --accent-gradient: linear-gradient(135deg, #7c3aed, #00d4ff);
            --success: #22c55e;
            --danger: #ef4444;
            --warning: #eab308;
            --info: #3b82f6;
            --purple: #a855f7;
            --orange: #f97316;
        }
        
        [data-theme="light"] {
            --bg-gradient: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
            --text-primary: #1e293b;
            --text-secondary: rgba(30, 41, 59, 0.8);
            --text-muted: rgba(30, 41, 59, 0.6);
            --text-faint: rgba(30, 41, 59, 0.4);
            --surface: rgba(0, 0, 0, 0.02);
            --surface-hover: rgba(0, 0, 0, 0.05);
            --surface-active: rgba(0, 0, 0, 0.08);
            --border: rgba(0, 0, 0, 0.1);
            --border-light: rgba(0, 0, 0, 0.05);
            --border-hover: rgba(0, 0, 0, 0.2);
        }
        
        /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’® */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 2px solid var(--border);
            background: var(--surface);
            backdrop-filter: blur(10px);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            transition: all 0.3s ease;
        }
        
        .theme-toggle:hover {
            transform: scale(1.1);
            border-color: var(--accent-start);
            box-shadow: 0 4px 20px rgba(0, 212, 255, 0.3);
        }
        
        /* ç²’å­èƒŒæ™¯å®¹å™¨ */
        #particles-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Microsoft YaHei', sans-serif; 
            background: var(--bg-gradient);
            min-height: 100vh; 
            color: var(--text-primary);
            overflow-x: hidden;
        }
        
        /* è‹±é›„åŒºåŸŸ - é¦–å± */
        .hero-section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
            padding: 20px;
        }
        
        .hero-title {
            font-size: clamp(2.5rem, 8vw, 5rem);
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-start), var(--accent-end), #f472b6, var(--accent-start));
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 4s ease infinite, titleFloat 3s ease-in-out infinite;
            margin-bottom: 20px;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        @keyframes titleFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        .hero-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            opacity: 0;
            animation: fadeInUp 1s ease forwards;
            animation-delay: 0.5s;
        }
        
        .hero-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: pulse 2s ease-in-out infinite, iconRotate 6s linear infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        @keyframes iconRotate {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }
        
        /* æ»šåŠ¨æç¤º */
        .scroll-indicator {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            opacity: 0;
            animation: fadeInUp 1s ease forwards, bounce 2s ease-in-out infinite;
            animation-delay: 1.5s, 2s;
        }
        
        .scroll-indicator span {
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        
        .scroll-arrow {
            width: 30px;
            height: 30px;
            border-right: 3px solid var(--text-muted);
            border-bottom: 3px solid var(--text-muted);
            transform: rotate(45deg);
            animation: scrollBounce 2s ease-in-out infinite;
        }
        
        @keyframes scrollBounce {
            0%, 100% { transform: rotate(45deg) translate(0, 0); opacity: 1; }
            50% { transform: rotate(45deg) translate(5px, 5px); opacity: 0.5; }
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(10px); }
        }
        
        /* å†…å®¹åŒºåŸŸ */
        .content-section {
            opacity: 0;
            transform: translateY(50px);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }
        
        .content-section.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
        
        .container { 
            max-width: 1100px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        header { 
            text-align: center; 
            padding: 30px 0; 
            margin-bottom: 20px; 
        }
        
        header h1 { 
            font-size: 28px; 
            background: linear-gradient(135deg, var(--accent-start), var(--accent-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px; 
            font-weight: 600; 
        }
        
        header p { 
            color: var(--text-muted); 
            font-size: 14px; 
        }
        
        .status-bar { 
            display: flex; 
            justify-content: center; 
            gap: 15px; 
            margin: 20px 0; 
            padding: 20px; 
            background: var(--surface);
            backdrop-filter: blur(10px);
            border-radius: 16px; 
            flex-wrap: wrap; 
            border: 1px solid var(--border);
        }
        
        .status-item { 
            text-align: center;
            padding: 15px 25px;
            background: var(--surface);
            border-radius: 12px;
            transition: all 0.3s ease;
            min-width: 100px;
        }
        
        .status-item:hover {
            transform: translateY(-5px) scale(1.05);
            background: var(--surface-active);
            box-shadow: 0 10px 40px rgba(0, 212, 255, 0.2);
        }
        
        .status-item .value { 
            font-size: 28px; 
            font-weight: 700; 
            background: linear-gradient(135deg, var(--accent-start), var(--accent-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .status-item .label { 
            font-size: 12px; 
            color: var(--text-muted); 
            margin-top: 5px; 
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .tabs { 
            display: flex; 
            gap: 8px; 
            margin-bottom: 20px; 
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .tab { 
            padding: 12px 20px; 
            background: var(--surface);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 12px; 
            color: var(--text-secondary); 
            cursor: pointer; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            font-size: 13px;
            font-weight: 500;
        }
        
        .tab:hover { 
            background: var(--surface-active);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .tab.active { 
            background: var(--accent-gradient);
            color: #fff; 
            border-color: transparent;
            box-shadow: 0 10px 40px rgba(124, 58, 237, 0.4);
        }
        
        .panel { 
            background: var(--surface);
            backdrop-filter: blur(20px);
            border-radius: 20px; 
            padding: 25px; 
            margin-bottom: 20px; 
            border: 1px solid var(--border-light);
            display: none;
            transition: all 0.3s ease;
        }
        
        .panel:hover {
            border-color: var(--border-hover);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .panel.active { display: block; }
        
        .panel h2 { 
            font-size: 16px; 
            margin-bottom: 18px; 
            color: var(--text-primary); 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            font-weight: 500; 
        }
        
        .panel h2::before { 
            content: ''; 
            width: 4px; 
            height: 20px; 
            background: linear-gradient(180deg, var(--accent-start), var(--accent-end));
            border-radius: 2px; 
        }
        
        .cve-panel { border-color: rgba(239, 68, 68, 0.3); }
        .cve-panel h2::before { background: linear-gradient(180deg, #ef4444, #f97316); }
        
        .mac-panel { border-color: rgba(168, 85, 247, 0.3); }
        .mac-panel h2::before { background: linear-gradient(180deg, #a855f7, #6366f1); }
        
        .ip-panel { border-color: rgba(34, 197, 94, 0.3); }
        .ip-panel h2::before { background: linear-gradient(180deg, #22c55e, #10b981); }
        
        .log-panel { border-color: rgba(59, 130, 246, 0.3); }
        .log-panel h2::before { background: linear-gradient(180deg, #3b82f6, #0ea5e9); }
        
        .cve-card { 
            background: var(--surface);
            border-radius: 12px; 
            padding: 18px; 
            margin-bottom: 15px; 
            border: 1px solid var(--border-light);
            border-left-width: 4px;
            transition: all 0.3s ease;
        }
        
        .cve-card:hover {
            background: var(--surface-hover);
            transform: translateX(5px);
        }
        
        .cve-card.critical { border-left-color: var(--danger); }
        .cve-card.high { border-left-color: var(--orange); }
        .cve-card.medium { border-left-color: var(--warning); }
        
        .cve-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-start; 
            margin-bottom: 12px; 
        }
        
        .cve-title { font-size: 15px; font-weight: 600; color: var(--text-primary); }
        .cve-id { font-size: 12px; color: var(--accent-start); font-family: Consolas, monospace; }
        .cve-meta { display: flex; gap: 15px; margin-bottom: 10px; }
        
        .cve-cvss { 
            padding: 4px 10px; 
            border-radius: 6px; 
            font-size: 11px; 
            font-weight: 600; 
        }
        
        .cve-cvss.critical { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        .cve-cvss.high { background: rgba(249, 115, 22, 0.2); color: var(--orange); }
        .cve-cvss.medium { background: rgba(234, 179, 8, 0.2); color: var(--warning); }
        
        .cve-desc { font-size: 12px; color: var(--text-muted); line-height: 1.6; margin-bottom: 12px; }
        .cve-protection { font-size: 11px; color: var(--success); }
        
        .toggle-switch { position: relative; width: 52px; height: 28px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        
        .toggle-slider { 
            position: absolute; 
            cursor: pointer; 
            inset: 0; 
            background: var(--surface-active);
            border-radius: 28px; 
            transition: 0.3s; 
        }
        
        .toggle-slider:before { 
            position: absolute; 
            content: ""; 
            height: 20px; 
            width: 20px; 
            left: 4px; 
            bottom: 4px; 
            background: var(--text-secondary);
            border-radius: 50%; 
            transition: 0.3s; 
        }
        
        .toggle-switch input:checked + .toggle-slider { 
            background: linear-gradient(135deg, var(--success), #10b981);
        }
        
        .toggle-switch input:checked + .toggle-slider:before { 
            transform: translateX(24px);
            background: #fff;
        }
        
        .form-row { display: flex; gap: 12px; margin-bottom: 12px; flex-wrap: wrap; }
        .form-group { flex: 1; min-width: 150px; }
        .form-group label { display: block; margin-bottom: 6px; color: var(--text-muted); font-size: 12px; }
        
        .form-group input { 
            width: 100%; 
            padding: 12px 16px; 
            border: 1px solid var(--border);
            border-radius: 10px; 
            background: var(--surface);
            color: var(--text-primary); 
            font-size: 13px;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus { 
            outline: none; 
            border-color: var(--accent-start);
            background: var(--surface-hover);
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
        }
        
        .form-group input::placeholder { color: var(--text-faint); }
        
        .btn { 
            padding: 10px 20px; 
            border: none; 
            border-radius: 10px; 
            font-size: 13px; 
            font-weight: 500; 
            cursor: pointer; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        
        .btn-primary { 
            background: var(--accent-gradient);
            color: #fff;
        }
        
        .btn-primary:hover { 
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(124, 58, 237, 0.4);
        }
        
        .btn-secondary { 
            background: var(--surface-active);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:hover { 
            background: var(--surface-hover);
        }
        
        .btn-danger { 
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .btn-danger:hover { 
            background: rgba(239, 68, 68, 0.3);
        }
        
        .btn-success { 
            background: rgba(34, 197, 94, 0.2);
            color: var(--success);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }
        
        .btn-success:hover { 
            background: rgba(34, 197, 94, 0.3);
        }
        
        .btn-sm { padding: 6px 12px; font-size: 11px; }
        
        .device-list, .ip-list, .log-list, .mac-list { 
            margin-top: 15px; 
            max-height: 350px; 
            overflow-y: auto;
        }
        
        .device-list::-webkit-scrollbar,
        .ip-list::-webkit-scrollbar,
        .log-list::-webkit-scrollbar,
        .mac-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .device-list::-webkit-scrollbar-thumb,
        .ip-list::-webkit-scrollbar-thumb,
        .log-list::-webkit-scrollbar-thumb,
        .mac-list::-webkit-scrollbar-thumb {
            background: var(--text-faint);
            border-radius: 3px;
        }
        
        .device-item, .ip-item, .log-item, .mac-item { 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            padding: 14px 16px; 
            background: var(--surface);
            border-radius: 10px; 
            margin-bottom: 8px; 
            border: 1px solid var(--border-light);
            transition: all 0.3s ease;
        }
        
        .device-item:hover, .ip-item:hover, .log-item:hover, .mac-item:hover { 
            background: var(--surface-hover);
            transform: translateX(5px);
            border-color: var(--border);
        }
        
        .device-info, .mac-info { display: flex; align-items: center; gap: 15px; flex: 1; min-width: 0; }
        .device-hostname { font-weight: 500; color: var(--text-primary); min-width: 90px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .device-ip { font-family: Consolas, monospace; font-size: 13px; }
        .device-ip.ipv4 { color: var(--accent-start); }
        .device-ip.ipv6 { color: var(--success); font-size: 11px; max-width: 150px; overflow: hidden; text-overflow: ellipsis; }
        .device-mac, .mac-addr { font-family: Consolas, monospace; font-size: 12px; color: var(--purple); }
        
        .ip-type-badge { 
            padding: 3px 8px; 
            border-radius: 6px; 
            font-size: 10px; 
            font-weight: 600; 
            text-transform: uppercase; 
        }
        
        .ip-type-badge.ipv4 { background: rgba(0, 212, 255, 0.2); color: var(--accent-start); }
        .ip-type-badge.ipv6 { background: rgba(34, 197, 94, 0.2); color: var(--success); }
        .ip-address { font-family: Consolas, monospace; font-size: 14px; color: var(--success); font-weight: 600; }
        .ip-description { color: var(--text-muted); font-size: 12px; }
        
        .log-info { flex: 1; min-width: 0; }
        .log-time { font-size: 11px; color: var(--text-muted); margin-bottom: 5px; }
        .log-detail { display: flex; gap: 15px; flex-wrap: wrap; font-size: 12px; }
        .log-detail span { font-family: Consolas, monospace; }
        .log-src { color: var(--danger); }
        .log-dst { color: var(--accent-start); }
        .log-proto { color: var(--success); }
        
        .empty-state { 
            text-align: center; 
            padding: 50px 20px; 
            color: var(--text-muted);
        }
        
        .empty-state .icon { font-size: 48px; margin-bottom: 15px; opacity: 0.5; }
        
        .toast { 
            position: fixed; 
            bottom: 25px; 
            right: 25px; 
            padding: 14px 24px; 
            border-radius: 12px; 
            color: #fff; 
            font-weight: 500; 
            opacity: 0; 
            transform: translateY(20px) scale(0.9);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .toast.show { opacity: 1; transform: translateY(0) scale(1); }
        .toast.success { background: rgba(34, 197, 94, 0.9); box-shadow: 0 10px 40px rgba(34, 197, 94, 0.3); }
        .toast.error { background: rgba(239, 68, 68, 0.9); box-shadow: 0 10px 40px rgba(239, 68, 68, 0.3); }
        
        .actions { display: flex; gap: 8px; }
        .header-actions { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        
        .search-box input { 
            width: 100%; 
            max-width: 320px; 
            padding: 12px 16px 12px 40px; 
            border: 1px solid var(--border);
            border-radius: 10px; 
            background: var(--surface) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cpath d='m21 21-4.35-4.35'/%3E%3C/svg%3E") no-repeat 14px center;
            color: var(--text-primary); 
            font-size: 13px;
            transition: all 0.3s ease;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: var(--accent-start);
            background-color: var(--surface-hover);
        }
        
        .quick-actions { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        
        /* åŠ¨ç”»æ•ˆæœç±» */
        .animate-in {
            animation: slideInUp 0.6s ease forwards;
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* å»¶è¿ŸåŠ¨ç”» */
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        .delay-4 { animation-delay: 0.4s; }
        
        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .hero-title { font-size: 2.5rem; }
            .status-item { min-width: 80px; padding: 10px 15px; }
            .status-item .value { font-size: 22px; }
            .tabs { justify-content: flex-start; }
            .tab { padding: 10px 14px; font-size: 12px; }
            .form-row { flex-direction: column; }
            .form-group { min-width: 100%; }
        }
    </style>
</head>
<body>
    <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
    <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
    
    <!-- ç²’å­èƒŒæ™¯ -->
    <canvas id="particles-canvas"></canvas>
    
    <!-- é¦–å±è‹±é›„åŒºåŸŸ -->
    <section class="hero-section">
        <div class="hero-icon">ğŸ”¥</div>
        <h1 class="hero-title">WFP Firewall Manager</h1>
        <p class="hero-subtitle">IP ç™½åå• & MAC ç™½åå• & CVE é˜²æŠ¤ & æ‹¦æˆªæ—¥å¿—</p>
        <div class="scroll-indicator">
            <span>å‘ä¸‹æ»šåŠ¨æŸ¥çœ‹æ›´å¤š</span>
            <div class="scroll-arrow"></div>
        </div>
    </section>
    
    <!-- å†…å®¹åŒºåŸŸ -->
    <section class="content-section">
        <div class="container">
            <header>
                <h1>ğŸ”¥ WFP Firewall Manager</h1>
                <p>å¼ºå¤§çš„ Windows é˜²ç«å¢™ç®¡ç†å·¥å…·</p>
            </header>
            
            <div class="status-bar">
                <div class="status-item">
                    <div class="value" id="ipWhitelistCount">0</div>
                    <div class="label">IPç™½åå•</div>
                </div>
                <div class="status-item">
                    <div class="value" id="macCount">0</div>
                    <div class="label">MACç™½åå•</div>
                </div>
                <div class="status-item">
                    <div class="value" id="logCount">0</div>
                    <div class="label">æ‹¦æˆªæ—¥å¿—</div>
                </div>
                <div class="status-item">
                    <div class="value" id="cveCount">0</div>
                    <div class="label">CVEé˜²æŠ¤</div>
                </div>
            </div>
            
            <div class="tabs">
                <div class="tab active" onclick="showTab('ip')">âœ… IPç™½åå•</div>
                <div class="tab" onclick="showTab('mac')">ğŸ”— MACç™½åå•</div>
                <div class="tab" onclick="showTab('lan')">ğŸŒ å±€åŸŸç½‘</div>
                <div class="tab" onclick="showTab('logs')">ğŸ“‹ æ‹¦æˆªæ—¥å¿—</div>
                <div class="tab" onclick="showTab('cve')">ğŸ›¡ï¸ CVEé˜²æŠ¤</div>
            </div>

            <!-- IPç™½åå• -->
            <div id="tab-ip" class="panel ip-panel active">
                <h2>IP åœ°å€ç™½åå•</h2>
                <div class="cve-card medium">
                    <div class="cve-title">âš ï¸ IP ç™½åå•é˜²æŠ¤</div>
                    <div class="cve-desc">å¯ç”¨åï¼Œåªæœ‰ç™½åå•ä¸­çš„ IP åœ°å€æ‰èƒ½ä¸æœ¬æœºå»ºç«‹å…¥ç«™è¿æ¥ã€‚æœªåœ¨ç™½åå•ä¸­çš„ IP å°†è¢«æ‹’ç»ï¼Œæœ‰æ•ˆé˜²æ­¢æœªæˆæƒè®¿é—®ã€‚</div>
                </div>
                <div class="cve-card" style="display:flex;justify-content:space-between;align-items:center">
                    <div><strong>IP è¿‡æ»¤</strong><br><small style="color:rgba(255,255,255,0.5)" id="ipFilterDesc">æœªå¯ç”¨</small></div>
                    <label class="toggle-switch"><input type="checkbox" id="ipToggle" onchange="toggleIpFilter()"><span class="toggle-slider"></span></label>
                </div>
                
                <h2 style="margin-top:25px">æ·»åŠ  IP åœ°å€</h2>
                <form id="addForm">
                    <div class="form-row">
                        <div class="form-group"><label>IPåœ°å€</label><input type="text" id="ipAddr" placeholder="192.168.1.1 æˆ– 2001:db8::1"></div>
                        <div class="form-group"><label>æè¿°</label><input type="text" id="ipDesc" placeholder="å¤‡æ³¨"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">æ·»åŠ </button>
                </form>
                <div class="header-actions" style="margin-top:20px">
                    <h2>ç™½åå•åˆ—è¡¨</h2>
                    <div class="actions">
                        <button class="btn btn-secondary btn-sm" onclick="loadIps()">åˆ·æ–°</button>
                        <button class="btn btn-danger btn-sm" onclick="clearAllIps()">æ¸…ç©º</button>
                    </div>
                </div>
                <div class="search-box"><input type="text" id="search" placeholder="æœç´¢..." oninput="filterIps()"></div>
                <div class="ip-list" id="ipList"></div>
            </div>

            <!-- MACç™½åå• -->
            <div id="tab-mac" class="panel mac-panel">
                <h2>MAC åœ°å€ç™½åå•</h2>
                <div class="cve-card medium">
                    <div class="cve-title">âš ï¸ MAC ç»‘å®šé˜²æŠ¤</div>
                    <div class="cve-desc">å¯ç”¨åï¼Œåªæœ‰ç™½åå•ä¸­çš„ MAC åœ°å€æ‰èƒ½ä¸æœ¬æœºé€šä¿¡ã€‚æœªåœ¨ç™½åå•ä¸­çš„è®¾å¤‡å°†è¢«æ‹’ç»å…¥ç«™è¿æ¥ï¼Œæœ‰æ•ˆé˜²æ­¢ IP ä¼ªé€ æ”»å‡»ã€‚</div>
                </div>
                <div class="cve-card" style="display:flex;justify-content:space-between;align-items:center">
                    <div><strong>MAC è¿‡æ»¤</strong><br><small style="color:rgba(255,255,255,0.5)" id="macFilterDesc">æœªå¯ç”¨</small></div>
                    <label class="toggle-switch"><input type="checkbox" id="macToggle" onchange="toggleMacFilter()"><span class="toggle-slider"></span></label>
                </div>
                
                <h2 style="margin-top:25px">æ·»åŠ  MAC åœ°å€</h2>
                <form id="addMacForm">
                    <div class="form-row">
                        <div class="form-group"><label>MACåœ°å€</label><input type="text" id="macAddr" placeholder="AA:BB:CC:DD:EE:FF"></div>
                        <div class="form-group"><label>æè¿°</label><input type="text" id="macDescInput" placeholder="è®¾å¤‡åç§°"></div>
                        <div class="form-group" style="flex:0.5"><label>å…³è”IP</label><input type="text" id="macIpv4" placeholder="å¯é€‰"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">æ·»åŠ </button>
                </form>
                <div class="header-actions" style="margin-top:20px">
                    <h2>ç™½åå•åˆ—è¡¨</h2>
                    <div class="actions">
                        <button class="btn btn-secondary btn-sm" onclick="loadMacs()">åˆ·æ–°</button>
                        <button class="btn btn-danger btn-sm" onclick="clearMacs()">æ¸…ç©º</button>
                    </div>
                </div>
                <div class="quick-actions">
                    <button class="btn btn-success btn-sm" onclick="addAllLanToMac()">ä»å±€åŸŸç½‘æ‰«ææ·»åŠ æ‰€æœ‰è®¾å¤‡</button>
                </div>
                <div class="mac-list" id="macList"></div>
            </div>

            <!-- å±€åŸŸç½‘ -->
            <div id="tab-lan" class="panel">
                <div class="header-actions">
                    <h2>å±€åŸŸç½‘è®¾å¤‡</h2>
                    <button class="btn btn-primary btn-sm" onclick="scanLan()">æ‰«æ</button>
                </div>
                <div class="device-list" id="deviceList"></div>
            </div>

            <!-- æ‹¦æˆªæ—¥å¿— -->
            <div id="tab-logs" class="panel log-panel">
                <div class="header-actions">
                    <h2>æ‹¦æˆªæ—¥å¿—</h2>
                    <div class="actions">
                        <button class="btn btn-secondary btn-sm" onclick="loadLogs()">åˆ·æ–°</button>
                        <button class="btn btn-danger btn-sm" onclick="clearLogs()">æ¸…ç©º</button>
                    </div>
                </div>
                <div class="log-list" id="logList"></div>
            </div>

            <!-- CVEé˜²æŠ¤ -->
            <div id="tab-cve" class="panel cve-panel">
                <h2>CVE æ¼æ´é˜²æŠ¤</h2>
                
                <!-- CVE-2024-38063 -->
                <div class="cve-card critical">
                    <div class="cve-header">
                        <div>
                            <div class="cve-title">Windows TCP/IP IPv6 è¿œç¨‹ä»£ç æ‰§è¡Œ</div>
                            <div class="cve-id">CVE-2024-38063</div>
                        </div>
                        <label class="toggle-switch"><input type="checkbox" id="cve2024_38063" onchange="toggleCve('cve2024_38063')"><span class="toggle-slider"></span></label>
                    </div>
                    <div class="cve-meta"><span class="cve-cvss critical">CVSS 9.8</span><span style="color:rgba(255,255,255,0.5);font-size:11px">2024å¹´7æœˆ</span></div>
                    <div class="cve-desc">Windows TCP/IP åè®®æ ˆå­˜åœ¨æ•´æ•°ä¸‹æº¢æ¼æ´ï¼Œæ”»å‡»è€…å¯é€šè¿‡å‘é€ç‰¹åˆ¶ IPv6 æ•°æ®åŒ…è¿œç¨‹æ‰§è¡Œä»£ç ï¼Œæ— éœ€ç”¨æˆ·äº¤äº’ã€‚</div>
                    <div class="cve-protection">ğŸ›¡ï¸ é˜²æŠ¤æ–¹å¼ï¼šé˜»æ–­æ‰€æœ‰ IPv6 æµé‡</div>
                </div>
                
                <!-- CVE-2023-44487 -->
                <div class="cve-card high">
                    <div class="cve-header">
                        <div>
                            <div class="cve-title">HTTP/2 Rapid Reset DoS æ”»å‡»</div>
                            <div class="cve-id">CVE-2023-44487</div>
                        </div>
                        <label class="toggle-switch"><input type="checkbox" id="cve2023_44487" onchange="toggleCve('cve2023_44487')"><span class="toggle-slider"></span></label>
                    </div>
                    <div class="cve-meta"><span class="cve-cvss high">CVSS 7.5</span><span style="color:rgba(255,255,255,0.5);font-size:11px">2023å¹´10æœˆ</span></div>
                    <div class="cve-desc">HTTP/2 åè®®å®ç°å­˜åœ¨æ¼æ´ï¼Œæ”»å‡»è€…å¯å‘é€å¤§é‡ RST_STREAM å¸§å¯¼è‡´æœåŠ¡å™¨èµ„æºè€—å°½ï¼Œé€ æˆæ‹’ç»æœåŠ¡æ”»å‡»ã€‚</div>
                    <div class="cve-protection">ğŸ›¡ï¸ é˜²æŠ¤æ–¹å¼ï¼šé™åˆ¶å¼‚å¸¸ HTTP/2 æµé‡ï¼ˆå¼€å‘ä¸­ï¼‰</div>
                </div>
                
                <!-- CVE-2023-38545 -->
                <div class="cve-card critical">
                    <div class="cve-header">
                        <div>
                            <div class="cve-title">curl SOCKS5 å †ç¼“å†²åŒºæº¢å‡º</div>
                            <div class="cve-id">CVE-2023-38545</div>
                        </div>
                        <label class="toggle-switch"><input type="checkbox" id="cve2023_38545" onchange="toggleCve('cve2023_38545')"><span class="toggle-slider"></span></label>
                    </div>
                    <div class="cve-meta"><span class="cve-cvss critical">CVSS 9.8</span><span style="color:rgba(255,255,255,0.5);font-size:11px">2023å¹´10æœˆ</span></div>
                    <div class="cve-desc">curl åº“åœ¨å¤„ç† SOCKS5 ä»£ç†æ—¶å­˜åœ¨å †ç¼“å†²åŒºæº¢å‡ºæ¼æ´ï¼Œå½“ä¸»æœºåè¶…è¿‡ 255 å­—èŠ‚æ—¶å¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚</div>
                    <div class="cve-protection">ğŸ›¡ï¸ é˜²æŠ¤æ–¹å¼ï¼šé˜»æ–­ SOCKS5 ä»£ç†æµé‡ï¼ˆç«¯å£ 1080ï¼‰</div>
                </div>
                
                <!-- CVE-2017-0144 EternalBlue -->
                <div class="cve-card critical">
                    <div class="cve-header">
                        <div>
                            <div class="cve-title">EternalBlue æ°¸æ’ä¹‹è“</div>
                            <div class="cve-id">CVE-2017-0144</div>
                        </div>
                        <label class="toggle-switch"><input type="checkbox" id="cve2017_0144" onchange="toggleCve('cve2017_0144')"><span class="toggle-slider"></span></label>
                    </div>
                    <div class="cve-meta"><span class="cve-cvss critical">CVSS 8.8</span><span style="color:rgba(255,255,255,0.5);font-size:11px">2017å¹´3æœˆ</span></div>
                    <div class="cve-desc">Windows SMBv1 æœåŠ¡å™¨å­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œæ”»å‡»è€…å¯å‘é€ç‰¹åˆ¶æ•°æ®åŒ…æ‰§è¡Œä»»æ„ä»£ç ã€‚WannaCry å‹’ç´¢ç—…æ¯’åˆ©ç”¨æ­¤æ¼æ´ä¼ æ’­ã€‚</div>
                    <div class="cve-protection">ğŸ›¡ï¸ é˜²æŠ¤æ–¹å¼ï¼šé˜»æ–­ SMB ç«¯å£ 445 å…¥ç«™æµé‡</div>
                </div>
                
                <!-- CVE-2024-45177 -->
                <div class="cve-card critical">
                    <div class="cve-header">
                        <div>
                            <div class="cve-title">Windows RDP è¿œç¨‹ä»£ç æ‰§è¡Œ</div>
                            <div class="cve-id">CVE-2024-45177</div>
                        </div>
                        <label class="toggle-switch"><input type="checkbox" id="cve2024_45177" onchange="toggleCve('cve2024_45177')"><span class="toggle-slider"></span></label>
                    </div>
                    <div class="cve-meta"><span class="cve-cvss critical">CVSS 9.8</span><span style="color:rgba(255,255,255,0.5);font-size:11px">2024å¹´9æœˆ</span></div>
                    <div class="cve-desc">Windows è¿œç¨‹æ¡Œé¢åè®®å­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œæ”»å‡»è€…å¯é€šè¿‡ RDP è¿æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚</div>
                    <div class="cve-protection">ğŸ›¡ï¸ é˜²æŠ¤æ–¹å¼ï¼šé˜»æ–­ RDP ç«¯å£ 3389 å…¥ç«™æµé‡</div>
                </div>
                
                <!-- CVE-2023-23397 -->
                <div class="cve-card high">
                    <div class="cve-header">
                        <div>
                            <div class="cve-title">Microsoft Outlook æƒé™æå‡</div>
                            <div class="cve-id">CVE-2023-23397</div>
                        </div>
                        <label class="toggle-switch"><input type="checkbox" id="cve2023_23397" onchange="toggleCve('cve2023_23397')"><span class="toggle-slider"></span></label>
                    </div>
                    <div class="cve-meta"><span class="cve-cvss high">CVSS 9.1</span><span style="color:rgba(255,255,255,0.5);font-size:11px">2023å¹´3æœˆ</span></div>
                    <div class="cve-desc">Microsoft Outlook å­˜åœ¨æƒé™æå‡æ¼æ´ï¼Œæ”»å‡»è€…å¯åˆ©ç”¨ç‰¹åˆ¶é‚®ä»¶è§¦å‘ NTLM è®¤è¯ï¼Œçªƒå–ç”¨æˆ·å‡­æ®ã€‚</div>
                    <div class="cve-protection">ğŸ›¡ï¸ é˜²æŠ¤æ–¹å¼ï¼šé˜»æ–­å¯ç–‘ UNC è·¯å¾„æµé‡</div>
                </div>
                
                <!-- CVE-2021-34527 -->
                <div class="cve-card critical">
                    <div class="cve-header">
                        <div>
                            <div class="cve-title">PrintNightmare æ‰“å°æœºæ¼æ´</div>
                            <div class="cve-id">CVE-2021-34527</div>
                        </div>
                        <label class="toggle-switch"><input type="checkbox" id="cve2021_34527" onchange="toggleCve('cve2021_34527')"><span class="toggle-slider"></span></label>
                    </div>
                    <div class="cve-meta"><span class="cve-cvss critical">CVSS 9.0</span><span style="color:rgba(255,255,255,0.5);font-size:11px">2021å¹´6æœˆ</span></div>
                    <div class="cve-desc">Windows æ‰“å°åå°å¤„ç†ç¨‹åºå­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œæ”»å‡»è€…å¯é€šè¿‡æ‰“å°æœºæœåŠ¡æ‰§è¡Œä»»æ„ä»£ç ã€‚</div>
                    <div class="cve-protection">ğŸ›¡ï¸ é˜²æŠ¤æ–¹å¼ï¼šé˜»æ–­æ‰“å°æœºç«¯å£ 9100 å…¥ç«™æµé‡</div>
                </div>
                
                <!-- CVE-2024-21745 -->
                <div class="cve-card critical">
                    <div class="cve-header">
                        <div>
                            <div class="cve-title">Windows DNS Server RCE</div>
                            <div class="cve-id">CVE-2024-21745</div>
                        </div>
                        <label class="toggle-switch"><input type="checkbox" id="cve2024_21745" onchange="toggleCve('cve2024_21745')"><span class="toggle-slider"></span></label>
                    </div>
                    <div class="cve-meta"><span class="cve-cvss critical">CVSS 9.8</span><span style="color:rgba(255,255,255,0.5);font-size:11px">2024å¹´2æœˆ</span></div>
                    <div class="cve-desc">Windows DNS æœåŠ¡å™¨å­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œæ”»å‡»è€…å¯é€šè¿‡ç‰¹åˆ¶ DNS è¯·æ±‚æ‰§è¡Œä»»æ„ä»£ç ã€‚</div>
                    <div class="cve-protection">ğŸ›¡ï¸ é˜²æŠ¤æ–¹å¼ï¼šé˜»æ–­å¼‚å¸¸ DNS æµé‡</div>
                </div>
                
                <!-- CVE-2021-44228 -->
                <div class="cve-card critical">
                    <div class="cve-header">
                        <div>
                            <div class="cve-title">Log4j è¿œç¨‹ä»£ç æ‰§è¡Œ (Log4Shell)</div>
                            <div class="cve-id">CVE-2021-44228</div>
                        </div>
                        <label class="toggle-switch"><input type="checkbox" id="cve2021_44228" onchange="toggleCve('cve2021_44228')"><span class="toggle-slider"></span></label>
                    </div>
                    <div class="cve-meta"><span class="cve-cvss critical">CVSS 10.0</span><span style="color:rgba(255,255,255,0.5);font-size:11px">2021å¹´12æœˆ</span></div>
                    <div class="cve-desc">Apache Log4j å­˜åœ¨ä¸¥é‡çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œæ”»å‡»è€…å¯é€šè¿‡ JNDI æ³¨å…¥æ‰§è¡Œä»»æ„ä»£ç ã€‚å½±å“å¹¿æ³›ï¼Œè¢«ç§°ä¸º Log4Shellã€‚</div>
                    <div class="cve-protection">ğŸ›¡ï¸ é˜²æŠ¤æ–¹å¼ï¼šæ£€æµ‹å¹¶é˜»æ–­ JNDI æ³¨å…¥ç‰¹å¾æµé‡</div>
                </div>
            </div>
        </div>
    </section>
    
    <div class="toast" id="toast"></div>

    <script>
        const $ = id => document.getElementById(id);
        let ipData = [], lanData = [], logData = [], macData = [], cveStatus = {};
        
        // ========== ä¸»é¢˜åˆ‡æ¢ ==========
        function toggleTheme() {
            const html = document.documentElement;
            const btn = document.querySelector('.theme-toggle');
            const isLight = html.getAttribute('data-theme') === 'light';
            
            if (isLight) {
                html.removeAttribute('data-theme');
                btn.textContent = 'ğŸŒ™';
                localStorage.setItem('theme', 'dark');
            } else {
                html.setAttribute('data-theme', 'light');
                btn.textContent = 'â˜€ï¸';
                localStorage.setItem('theme', 'light');
            }
        }
        
        // åˆå§‹åŒ–ä¸»é¢˜
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            const btn = document.querySelector('.theme-toggle');
            if (savedTheme === 'light') {
                document.documentElement.setAttribute('data-theme', 'light');
                btn.textContent = 'â˜€ï¸';
            }
        }
        
        initTheme();
        
        // ========== ç²’å­èƒŒæ™¯æ•ˆæœ ==========
        const canvas = $('particles-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        let mouseX = 0, mouseY = 0;
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        class Particle {
            constructor() {
                this.reset();
            }
            
            reset() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 2 + 1;
                this.speedX = (Math.random() - 0.5) * 0.5;
                this.speedY = (Math.random() - 0.5) * 0.5;
                this.opacity = Math.random() * 0.5 + 0.2;
                this.hue = Math.random() * 60 + 200; // è“ç´«è‰²è°ƒ
            }
            
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                
                // é¼ æ ‡äº¤äº’
                const dx = mouseX - this.x;
                const dy = mouseY - this.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                if (dist < 100) {
                    this.x -= dx * 0.02;
                    this.y -= dy * 0.02;
                }
                
                // è¾¹ç•Œæ£€æµ‹
                if (this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height) {
                    this.reset();
                }
            }
            
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = `hsla(${this.hue}, 70%, 60%, ${this.opacity})`;
                ctx.fill();
            }
        }
        
        function initParticles() {
            particles = [];
            const count = Math.min(80, Math.floor((canvas.width * canvas.height) / 15000));
            for (let i = 0; i < count; i++) {
                particles.push(new Particle());
            }
        }
        
        function drawConnections() {
            for (let i = 0; i < particles.length; i++) {
                for (let j = i + 1; j < particles.length; j++) {
                    const dx = particles[i].x - particles[j].x;
                    const dy = particles[i].y - particles[j].y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    
                    if (dist < 120) {
                        ctx.beginPath();
                        ctx.moveTo(particles[i].x, particles[i].y);
                        ctx.lineTo(particles[j].x, particles[j].y);
                        ctx.strokeStyle = `rgba(100, 200, 255, ${0.15 * (1 - dist / 120)})`;
                        ctx.lineWidth = 0.5;
                        ctx.stroke();
                    }
                }
            }
        }
        
        function animateParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            particles.forEach(p => {
                p.update();
                p.draw();
            });
            
            drawConnections();
            requestAnimationFrame(animateParticles);
        }
        
        // åˆå§‹åŒ–ç²’å­
        resizeCanvas();
        initParticles();
        animateParticles();
        
        window.addEventListener('resize', () => {
            resizeCanvas();
            initParticles();
        });
        
        document.addEventListener('mousemove', e => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });
        
        // ========== æ»šåŠ¨æ˜¾ç¤ºæ•ˆæœ ==========
        const contentSection = document.querySelector('.content-section');
        const heroSection = document.querySelector('.hero-section');
        
        function checkScroll() {
            const scrollY = window.scrollY;
            const triggerPoint = window.innerHeight * 0.3;
            
            if (scrollY > triggerPoint) {
                contentSection.classList.add('visible');
            }
        }
        
        window.addEventListener('scroll', checkScroll);
        checkScroll();
        
        // ========== åŸæœ‰åŠŸèƒ½ä»£ç  ==========
        const toast = (m, t = 'success') => { 
            const e = $('toast'); 
            e.textContent = m; 
            e.className = 'toast ' + t + ' show'; 
            setTimeout(() => e.classList.remove('show'), 2500); 
        };
        
        const showTab = t => { 
            document.querySelectorAll('.tab').forEach(x => x.classList.remove('active')); 
            document.querySelectorAll('.panel').forEach(x => x.classList.remove('active')); 
            event.target.classList.add('active'); 
            $('tab-' + t).classList.add('active'); 
        };
        
        const loadStatus = async () => { 
            try { 
                const r = await fetch('/api/status'); 
                const d = await r.json(); 
                $('ipWhitelistCount').textContent = d.ipWhitelistCount || 0;
                $('logCount').textContent = d.logCount || 0;
                $('macCount').textContent = d.macWhitelistCount || 0;
                if (d.cve) {
                    cveStatus = d.cve;
                    let activeCve = 0;
                    for (const [k, v] of Object.entries(cveStatus)) {
                        const el = $(k);
                        if (el) el.checked = v;
                        if (v) activeCve++;
                    }
                    $('cveCount').textContent = activeCve;
                }
                $('ipToggle').checked = d.ipFilterEnabled;
                $('ipFilterDesc').textContent = d.ipFilterEnabled ? 'å·²å¯ç”¨' : 'æœªå¯ç”¨';
                $('macToggle').checked = d.macFilterEnabled;
                $('macFilterDesc').textContent = d.macFilterEnabled ? 'å·²å¯ç”¨' : 'æœªå¯ç”¨';
            } catch(e){} 
        };
        
        const loadIps = async () => { try { const r = await fetch('/api/ips'); ipData = await r.json(); renderIps(); loadStatus(); } catch(e){ toast('åŠ è½½å¤±è´¥', 'error'); } };
        const loadLan = async () => { try { const r = await fetch('/api/lan'); lanData = await r.json(); renderLan(); } catch(e){} };
        const loadLogs = async () => { try { const r = await fetch('/api/logs'); logData = await r.json(); renderLogs(); loadStatus(); } catch(e){ toast('åŠ è½½æ—¥å¿—å¤±è´¥', 'error'); } };
        const loadMacs = async () => { try { const r = await fetch('/api/mac'); macData = await r.json(); renderMacs(); loadStatus(); } catch(e){ toast('åŠ è½½MACå¤±è´¥', 'error'); } };
        
        const renderIps = (f = '') => { 
            const el = $('ipList'); 
            const d = ipData.filter(i => i.ip.includes(f) || i.description.includes(f)); 
            if (!d.length) { 
                el.innerHTML = '<div class="empty-state"><div class="icon">âœ…</div><p>æš‚æ— IPç™½åå•</p></div>'; 
                return; 
            } 
            el.innerHTML = d.map(i => '<div class="ip-item"><div class="device-info"><span class="ip-type-badge ' + (i.ip_type === 'IPv6' ? 'ipv6' : 'ipv4') + '">' + (i.ip_type || 'IPv4') + '</span><span class="ip-address">' + i.ip + '</span><span class="ip-description">' + (i.description || '-') + '</span></div><button class="btn btn-danger btn-sm" onclick="removeIp(\'' + i.ip + '\')">ç§»é™¤</button></div>').join(''); 
        };
        
        const filterIps = () => renderIps($('search').value);
        
        const renderMacs = () => { 
            const el = $('macList'); 
            if (!macData.length) { 
                el.innerHTML = '<div class="empty-state"><div class="icon">ğŸ”—</div><p>æš‚æ— MACç™½åå•</p></div>'; 
                return; 
            } 
            el.innerHTML = macData.map(m => '<div class="mac-item"><div class="mac-info"><span class="mac-addr">' + m.mac + '</span><span style="color:rgba(255,255,255,0.5)">' + (m.description || '-') + '</span><span class="device-ip ipv4">' + (m.ipv4 || '-') + '</span></div><button class="btn btn-danger btn-sm" onclick="removeMac(\'' + m.mac + '\')">ç§»é™¤</button></div>').join(''); 
        };
        
        const renderLan = () => { 
            const el = $('deviceList'); 
            if (!lanData.length) { 
                el.innerHTML = '<div class="empty-state"><div class="icon">ğŸŒ</div><p>ç‚¹å‡»æ‰«ææŸ¥çœ‹å±€åŸŸç½‘è®¾å¤‡</p></div>'; 
                return; 
            } 
            el.innerHTML = lanData.map(d => '<div class="device-item"><div class="device-info"><span class="device-hostname">' + d.hostname + '</span><span class="device-ip ipv4">' + d.ipv4 + '</span><span class="mac-addr">' + d.mac + '</span></div><div class="actions"><button class="btn btn-success btn-sm" onclick="addIpFromLan(\'' + d.ipv4 + '\',\'' + d.hostname + '\')">åŠ å…¥IPç™½åå•</button><button class="btn btn-success btn-sm" onclick="addMacFromLan(\'' + d.mac + '\',\'' + d.hostname + '\',\'' + d.ipv4 + '\')">åŠ å…¥MACç™½åå•</button></div></div>').join(''); 
        };
        
        const renderLogs = () => { 
            const el = $('logList'); 
            if (!logData.length) { 
                el.innerHTML = '<div class="empty-state"><div class="icon">ğŸ“‹</div><p>æš‚æ— æ‹¦æˆªè®°å½•</p></div>'; 
                return; 
            } 
            el.innerHTML = logData.map(l => '<div class="log-item"><div class="log-info"><div class="log-time">' + l.timestamp + ' | ' + l.direction + '</div><div class="log-detail"><span class="log-src">' + l.srcIp + (l.srcPort ? ':' + l.srcPort : '') + '</span> â†’ <span class="log-dst">' + l.dstIp + (l.dstPort ? ':' + l.dstPort : '') + '</span> | <span class="log-proto">' + l.protocol + '</span></div></div></div>').join(''); 
        };
        
        const scanLan = async () => { 
            try { 
                const r = await fetch('/api/lan/scan', {method:'POST'}); 
                lanData = await r.json(); 
                renderLan(); 
                loadStatus(); 
                toast('æ‰«æå®Œæˆï¼Œå‘ç° ' + lanData.length + ' ä¸ªè®¾å¤‡'); 
            } catch(e){ 
                toast('æ‰«æå¤±è´¥', 'error'); 
            } 
        };
        
        const toggleCve = async (cveId) => { 
            const el = $(cveId);
            const on = el.checked;
            try { 
                const params = new URLSearchParams(); 
                params.append('cve', cveId); 
                params.append('enabled', on ? 'true' : 'false'); 
                await fetch('/api/cve/toggle', {method:'POST', body:params, headers:{'Content-Type':'application/x-www-form-urlencoded'}}); 
                toast(on ? 'é˜²æŠ¤å·²å¼€å¯' : 'é˜²æŠ¤å·²å…³é—­'); 
                loadStatus();
            } catch(e){ 
                el.checked = !on; 
                toast('æ“ä½œå¤±è´¥', 'error'); 
            } 
        };
        
        const toggleIpFilter = async () => { 
            const on = $('ipToggle').checked; 
            try { 
                const params = new URLSearchParams(); 
                params.append('enabled', on ? 'true' : 'false'); 
                await fetch('/api/ips/toggle', {method:'POST', body:params, headers:{'Content-Type':'application/x-www-form-urlencoded'}}); 
                $('ipFilterDesc').textContent = on ? 'å·²å¯ç”¨' : 'æœªå¯ç”¨'; 
                toast(on ? 'IPè¿‡æ»¤å·²å¼€å¯' : 'IPè¿‡æ»¤å·²å…³é—­'); 
            } catch(e){ 
                $('ipToggle').checked = !on; 
            } 
        };
        
        const toggleMacFilter = async () => { 
            const on = $('macToggle').checked; 
            try { 
                const params = new URLSearchParams(); 
                params.append('enabled', on ? 'true' : 'false'); 
                await fetch('/api/mac/toggle', {method:'POST', body:params, headers:{'Content-Type':'application/x-www-form-urlencoded'}}); 
                $('macFilterDesc').textContent = on ? 'å·²å¯ç”¨' : 'æœªå¯ç”¨'; 
                toast(on ? 'MACè¿‡æ»¤å·²å¼€å¯' : 'MACè¿‡æ»¤å·²å…³é—­'); 
            } catch(e){ 
                $('macToggle').checked = !on; 
            } 
        };
        
        $('addForm').onsubmit = async e => { 
            e.preventDefault(); 
            const ip = $('ipAddr').value.trim(), desc = $('ipDesc').value.trim(); 
            if (!ip) return; 
            try { 
                const params = new URLSearchParams(); 
                params.append('ip', ip); 
                params.append('description', desc); 
                const r = await fetch('/api/ips', {method:'POST', body:params, headers:{'Content-Type':'application/x-www-form-urlencoded'}}); 
                const d = await r.json(); 
                if (d.success) { 
                    toast('å·²æ·»åŠ åˆ°ç™½åå•'); 
                    $('addForm').reset(); 
                    loadIps(); 
                } else toast(d.error, 'error'); 
            } catch(e){ 
                toast('å¤±è´¥', 'error'); 
            } 
        };
        
        $('addMacForm').onsubmit = async e => { 
            e.preventDefault(); 
            const mac = $('macAddr').value.trim(), desc = $('macDescInput').value.trim(), ipv4 = $('macIpv4').value.trim(); 
            if (!mac) return; 
            try { 
                const params = new URLSearchParams(); 
                params.append('mac', mac); 
                params.append('description', desc); 
                params.append('ipv4', ipv4); 
                const r = await fetch('/api/mac', {method:'POST', body:params, headers:{'Content-Type':'application/x-www-form-urlencoded'}}); 
                const d = await r.json(); 
                if (d.success) { 
                    toast('å·²æ·»åŠ '); 
                    $('addMacForm').reset(); 
                    loadMacs(); 
                } else toast(d.error, 'error'); 
            } catch(e){ 
                toast('å¤±è´¥', 'error'); 
            } 
        };
        
        const removeIp = async ip => { 
            if (!confirm('ä»ç™½åå•ç§»é™¤ ' + ip + '?')) return; 
            try { 
                const params = new URLSearchParams(); 
                params.append('ip', ip); 
                await fetch('/api/ips', {method:'DELETE', body:params, headers:{'Content-Type':'application/x-www-form-urlencoded'}}); 
                toast('å·²ç§»é™¤'); 
                loadIps(); 
            } catch(e){} 
        };
        
        const removeMac = async mac => { 
            if (!confirm('ç§»é™¤ ' + mac + '?')) return; 
            try { 
                const params = new URLSearchParams(); 
                params.append('mac', mac); 
                await fetch('/api/mac', {method:'DELETE', body:params, headers:{'Content-Type':'application/x-www-form-urlencoded'}}); 
                toast('å·²ç§»é™¤'); 
                loadMacs(); 
            } catch(e){} 
        };
        
        const clearAllIps = async () => { 
            if (!confirm('æ¸…ç©ºæ‰€æœ‰IPç™½åå•?')) return; 
            await fetch('/api/ips/all', {method:'DELETE'}); 
            toast('å·²æ¸…ç©º'); 
            loadIps(); 
        };
        
        const clearMacs = async () => { 
            if (!confirm('æ¸…ç©ºæ‰€æœ‰MACç™½åå•?')) return; 
            await fetch('/api/mac/all', {method:'DELETE'}); 
            toast('å·²æ¸…ç©º'); 
            loadMacs(); 
        };
        
        const clearLogs = async () => { 
            if (!confirm('æ¸…ç©ºæ‰€æœ‰æ—¥å¿—?')) return; 
            await fetch('/api/logs', {method:'DELETE'}); 
            toast('æ—¥å¿—å·²æ¸…ç©º'); 
            loadLogs(); 
        };
        
        const addIpFromLan = (ip, name) => { 
            if (ip === '-') return; 
            $('ipAddr').value = ip; 
            $('ipDesc').value = name; 
            showTab('ip'); 
        };
        
        const addMacFromLan = (mac, name, ip) => { 
            $('macAddr').value = mac; 
            $('macDescInput').value = name; 
            $('macIpv4').value = ip; 
            showTab('mac'); 
        };
        
        const addAllLanToMac = async () => { 
            if (!lanData.length) { 
                toast('è¯·å…ˆæ‰«æå±€åŸŸç½‘', 'error'); 
                return; 
            }
            let added = 0;
            for (const d of lanData) {
                if (d.mac && d.mac !== '-') {
                    try { 
                        const params = new URLSearchParams(); 
                        params.append('mac', d.mac); 
                        params.append('description', d.hostname); 
                        params.append('ipv4', d.ipv4); 
                        const r = await fetch('/api/mac', {method:'POST', body:params, headers:{'Content-Type':'application/x-www-form-urlencoded'}}); 
                        if ((await r.json()).success) added++; 
                    } catch(e){}
                }
            }
            toast('å·²æ·»åŠ  ' + added + ' ä¸ªè®¾å¤‡åˆ°ç™½åå•');
            loadMacs();
        };
        
        // åˆå§‹åŒ–åŠ è½½
        loadIps(); 
        loadLan(); 
        loadLogs(); 
        loadMacs(); 
        loadStatus();
        setInterval(() => { loadStatus(); loadLogs(); }, 5000);
    </script>
</body>
</html>