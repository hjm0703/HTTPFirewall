<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹¦æˆªæ—¥å¿— - WFP Firewall</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
    <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
    
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <a href="index.html" class="navbar-brand">ğŸ”¥ WFP Firewall</a>
        <div class="navbar-nav">
            <a href="ip.html" class="nav-link">âœ… IPç™½åå•</a>
            <a href="mac.html" class="nav-link">ğŸ”— MACç™½åå•</a>
            <a href="ports.html" class="nav-link">ğŸ”Œ ç«¯å£ç®¡ç†</a>
            <a href="lan.html" class="nav-link">ğŸŒ å±€åŸŸç½‘</a>
            <a href="logs.html" class="nav-link active">ğŸ“‹ æ‹¦æˆªæ—¥å¿—</a>
            <a href="cve.html" class="nav-link">ğŸ›¡ï¸ CVEé˜²æŠ¤</a>
        </div>
    </nav>
    
    <!-- ç²’å­èƒŒæ™¯ -->
    <canvas id="particles-canvas"></canvas>
    
    <!-- ä¸»å†…å®¹ -->
    <main class="main-content">
        <div class="container">
            <div class="panel log-panel">
                <div class="header-actions">
                    <h2>ğŸ“‹ æ‹¦æˆªæ—¥å¿—</h2>
                    <div class="actions">
                        <button class="btn btn-secondary btn-sm" onclick="loadLogs()">åˆ·æ–°</button>
                        <button class="btn btn-danger btn-sm" onclick="clearLogs()">æ¸…ç©º</button>
                    </div>
                </div>
                <div class="cve-card medium">
                    <div class="cve-title">æ‹¦æˆªè®°å½•</div>
                    <div class="cve-desc">æ˜¾ç¤ºè¢«é˜²ç«å¢™æ‹¦æˆªçš„ç½‘ç»œè¿æ¥è®°å½•ï¼ŒåŒ…æ‹¬æ—¶é—´ã€æº/ç›®æ ‡ IPã€åè®®ç­‰ä¿¡æ¯ã€‚</div>
                </div>
                <div class="log-list" id="logList"></div>
            </div>
        </div>
    </main>
    
    <div class="toast" id="toast"></div>

    <script src="common.js"></script>
    <script>
        let logData = [];
        
        const loadLogs = async () => { 
            try { 
                const r = await fetch('/api/logs'); 
                logData = await r.json(); 
                renderLogs(); 
            } catch(e){ showToast('åŠ è½½æ—¥å¿—å¤±è´¥', 'error'); } 
        };
        
        const renderLogs = () => { 
            const el = document.getElementById('logList'); 
            if (!logData.length) { 
                el.innerHTML = '<div class="empty-state"><div class="icon">ğŸ“‹</div><p>æš‚æ— æ‹¦æˆªè®°å½•</p></div>'; 
                return; 
            } 
            el.innerHTML = logData.map(l => '<div class="log-item"><div class="log-info"><div class="log-time">' + l.timestamp + ' | ' + l.direction + '</div><div class="log-detail"><span class="log-src">' + l.srcIp + (l.srcPort ? ':' + l.srcPort : '') + '</span> â†’ <span class="log-dst">' + l.dstIp + (l.dstPort ? ':' + l.dstPort : '') + '</span> | <span class="log-proto">' + l.protocol + '</span></div></div></div>').join(''); 
        };
        
        const clearLogs = async () => { 
            if (!confirm('æ¸…ç©ºæ‰€æœ‰æ—¥å¿—?')) return; 
            await fetch('/api/logs', {method:'DELETE'}); 
            showToast('æ—¥å¿—å·²æ¸…ç©º'); 
            loadLogs(); 
        };
        
        // åˆå§‹åŒ–
        loadLogs();
        // å®šæ—¶åˆ·æ–°
        setInterval(loadLogs, 5000);
    </script>
</body>
</html>
